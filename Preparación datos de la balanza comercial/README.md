# Descripción del contenido

- **Datos en bruto**: Aquí se encontrará el enlace a los datos públicos que se han empleado para la generación de la información relevante a la balanza comercial, los datos proceden de la *Agencia Tributaria*.

- **Scripts**: En esta carpeta se encuentran los scripts que se han usado para generar la tabla que posteriormente se ha usado para crear las visualizaciones con *Tableau*.

  - **R**: Se han creado dos scripts diferentes:
    - **script_creacion_tabla_agencia_trib_y_tabla_scrapeo.Rmd**: En este script se hacen dos tareas diferentes:
      - En primer lugar se leen los datos procedentes de la *Agencia Tributaria*, se filtran dejando solo los datos de la ciudad de València y se almacenan en una misma tabla. Se codifica el codigo de país de Namibia (NA) para que no sea reconocido como un valor faltante *NA*, se seleccionan las variables que nos interesan y se guarda la tabla resultante con el nombre *tabla_productos_codigo_nc.csv*. *Nota: Esta tabla no ha sido dejada en la carpeta de tablas generadas, ya que ocupa 99,4 MB*. 
      - En segundo lugar se obtiene una tabla que se ha llamado *codigo_nc_scrapeo.csv* con los códigos de los productos importados y/o exportados, que posteriormente se ha usado con la librería *Scrapy* de *Python* para obtener las categorías de los productos scrapeando la página [European Customs Portal](https://www.tariffnumber.com/).
    - **script_creacion_tabla_agencia_trib - anual - agrupaciones.Rmd**: En este script se generan las agrupaciones necesarias para las visualizaciones en *Tableau* a partir de la tabla creada con el script anterior *tabla_productos_codigo_nc.csv*. Aunque *Tableau* es capaz de realizar esas agrupaciones directamente, ha sido necesario hacerlas debido a que de no hacerlo serían más de un millón de filas en la tabla y *Tableau* no podría leerlo. Las agrupaciones que se han llevado a cabo han sido por año, flujo de comercio (importación y/o exportación), país y categoría de producto (incluyendo una categoría que denota a todos los productos). La tabla generada es guardada con el nombre *tabla_por_grupos.csv*.
    
  - **Python**: En este caso tenemos dos scripts y una carpeta *Scrapeo Codigos NC*:
    - **Scrapeo Codigos NC**: En esta carpeta se encuentra el script de scrapeo que se ha usado para traducir el código de la categoría de los productos de la *Agencia Tributaria*. El script que ejecuta esta petición en concreto se encuentra en la carpeta *spiders* y tiene como nombre *quotes_spider.py*. Con este script de la librería *Scrapy* generamos el archivo *json_codigo_nc_categoria.json*, para generarlo se usa el comando *scrapy crawl quotes -o quotes.json* en la raíz de esta carpeta *Scrapeo Codigos NC*.
    - **Creación_diccionario_codigo_nc.py**: Con este script generamos el diccionario de *Python* con nombre *diccionario_python_sin_reemplazo.json* usando el archivo que hemos escrapeado *json_codigo_nc_categoria.json*. Posteriormente se ha traducido al Valenciano este diccionario y se ha guardado como tabla en formato *.csv* usando el programa *Microsoft Excel*, con nombre *diccionario_codigo_nc_valenciano.csv*.
    - **Reemplazar_python_paises_import.py**: En este script se llevan a cabo los reemplazos/traducciones de los códigos que tienen los datos de la *Agencia Tributaria* a lo que realmente representan en Valenciano. Para ello se usan las tablas que hay en la carpeta [Tablas de reemplazo](https://github.com/areahackerscivics/Migrador/tree/master/Preparaci%C3%B3n%20datos%20de%20la%20balanza%20comercial/Tablas%20de%20reemplazo), los códigos que serán reemplazados con este script serán los de categoría de producto, los de importación y/o exportación, de países y se añadirá una variable que denote la región del país. El resultado es la generación de una tabla con nombre *Tabla_I_E_por_grupos_completa.csv*.
   
- **Tablas de reemplazo**: En esta carpeta se encuentran las tablas que se han usado para reemplazar/traducir los códigos de los datos que nos ha proporcionado la *Agencia Tributaria*. La tabla *diccionario_codigo_nc_valenciano.csv* ya ha sido descrita y su modo de obtención. El resto son tabla donde en una columna tienen un código y en otra lo que representa ese código. La de el código de países ha sido obtenida desde [el portal de la *Agencia Tributaria*](http://www.agenciatributaria.es/static_files/AEAT/Contenidos_Comunes/La_Agencia_Tributaria/Modelos_y_formularios/Declaraciones/Resto_de_modelos/696/Codigo_paises.pdf), y el resto ha sido generada con *Microsoft Excel* a través de los datos de la *Agencia Tributaria* y la *ONU*.

- **Tablas generadas**: Aquí se encuentran las tablas que se han ido generando con cada *script* además de la tabla  *tabla_por_grupos_con_reemplazos.xlsx*, que es la misma tabla de *Tabla_I_E_por_grupos_completa.csv* solo que pasada a formato de *Microsoft Excel* para facilitar la lectura de la tabla con *Tableau*.
    
